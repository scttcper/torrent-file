# torrent-file [![npm](https://badgen.net/npm/v/@ctrl/torrent-file)](https://www.npmjs.com/package/@ctrl/torrent-file) [![coverage](https://badgen.net/codecov/c/github/scttcper/torrent-file)](https://codecov.io/gh/scttcper/torrent-file)

> Parse a torrent file and read encoded data.

This project is based on [parse-torrent](https://www.npmjs.com/package/parse-torrent) and [node-bencode](https://github.com/themasch/node-bencode) to parse the data of a torrent file. This library implements its own [bencode](http://www.bittorrent.org/beps/bep_0003.html) encoder and decoder that does not use `Buffer`.

### Install

```console
npm install @ctrl/torrent-file
```

### API

##### info

The content of the metainfo file.

```ts
import fs from 'fs';

import { info } from '@ctrl/torrent-file';

const torrentInfo = info(fs.readFileSync('myfile'));
console.log({ torrentInfo });
```

##### files

data about the files described in the torrent file, includes hashes of the pieces

```ts
import fs from 'fs';

import { files } from '@ctrl/torrent-file';

const torrentFiles = files(fs.readFileSync('myfile'));
console.log({ torrentFiles });
```

##### hash

sha1 of torrent file info. This hash is commonly used by torrent clients as the ID of the torrent.

Note: This function is synchronous and uses Node.js `crypto` under the hood.

```ts
import fs from 'fs';

import { hash } from '@ctrl/torrent-file';

(async () => {
  const torrentHash = await hash(fs.readFileSync('myfile'));
  console.log({ torrentHash });
})();
```

### See Also

[parse-torrent](https://www.npmjs.com/package/parse-torrent) - "@ctrl/torrent-file" torrent parsing based very heavily off this project  
[node-bencode](https://github.com/themasch/node-bencode) - bencoder built into this project heavily based off this project

### Encode

Convert a parsed torrent object back into a `.torrent` file buffer.

```ts
import fs from 'fs'

import { toTorrentFile } from '@ctrl/torrent-file'

// Minimal example: create a .torrent buffer from fields
const buf = toTorrentFile({
  info: {
    // Required info fields
    'piece length': 16384,
    pieces: new Uint8Array(/* 20-byte SHA1 hashes concatenated */),
    name: 'example.txt',
    length: 12345,
  },
  // Optional fields
  announce: ['udp://tracker.publicbt.com:80/announce'],
  urlList: ['https://example.com/example.txt'],
  private: false,
  created: new Date(),
  createdBy: 'my-app/1.0.0',
  comment: 'Generated by @ctrl/torrent-file',
})

fs.writeFileSync('example.torrent', buf)
```

### Demo

Run a local demo UI to drop a `.torrent` file and view parsed output:

```bash
pnpm install
pnpm demo:watch
```

To build the demo for static hosting:

```bash
pnpm demo:build
```
